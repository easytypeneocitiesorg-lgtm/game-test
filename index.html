<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cube Encounter Game</title>
  <style>
    body { margin:0; background:black; color:white; font-family:sans-serif; }
    canvas { display:block; margin:0 auto; background:black; }
    #ui { text-align:center; margin-top:10px; }
    .healthRow {
      display:flex;
      justify-content:space-around;
      margin-bottom:10px;
    }
    .healthBox {
      position:relative;
      width:200px;
    }
    .floatText {
      position:absolute;
      top:-20px;
      left:50%;
      transform:translateX(-50%);
      font-weight:bold;
      animation: floatUp 1.5s ease-out forwards;
    }
    .enemyDamage { color: yellow; }
    .playerDamage { color: red; }
    .playerHeal { color: green; }
    button { margin:5px; padding:10px 20px; font-size:16px; }
    button:disabled {
      background-color: #555;
      color: #aaa;
      cursor: not-allowed;
    }
    @keyframes floatUp {
      from { top:-20px; opacity:1; }
      to { top:-50px; opacity:0; }
    }
    #volumeControl {
      position:absolute;
      top:10px;
      left:10px;
    }
    #cheatBtn {
      position:absolute;
      top:10px;
      right:10px;
      width:40px;
      height:40px;
      opacity:0; /* invisible */
      cursor:default; /* cursor doesnâ€™t change */
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="600" height="400"></canvas>
  <!-- Volume slider -->
  <input id="volumeControl" type="range" min="0" max="1" step="0.01" value="0.25">
  <!-- Invisible cheat button -->
  <button id="cheatBtn"></button>
  
  <div id="ui" style="display:none;">
    <div class="healthRow">
      <div class="healthBox">
        <p id="playerHealth"></p>
        <div id="playerFloatLayer"></div>
      </div>
      <div class="healthBox">
        <p id="enemyHealth"></p>
        <div id="enemyFloatLayer"></div>
      </div>
    </div>
    <button id="attackBtn">Attack</button>
    <button id="healBtn">Heal</button>
    <button id="restartBtn" style="display:none;">Restart</button>
    <p id="message"></p>
    <p id="healCount"></p>
  </div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const volumeSlider = document.getElementById("volumeControl");
const cheatBtn = document.getElementById("cheatBtn");

let player, enemyCube, keys, inEncounter, enemy, healUses, cooldown, infiniteHeals;

function initGame() {
  player = { x:50, y:50, size:30, color:"blue", health:36, maxHealth:50 };
  enemyCube = { x: Math.random()*550, y: Math.random()*350, size:30, color:"red" };
  keys = {};
  inEncounter = false;
  enemy = null;
  healUses = 3;
  infiniteHeals = false;
  cooldown = false;
  document.getElementById("ui").style.display = "none";
  document.getElementById("attackBtn").disabled = false;
  document.getElementById("healBtn").disabled = false;
  document.getElementById("restartBtn").style.display = "none";
  updateHealCount();
}
initGame();

document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

cheatBtn.addEventListener("click", () => {
  infiniteHeals = true;
  updateHealCount();
});

function update() {
  if (!inEncounter) {
    if (keys["ArrowUp"] || keys["w"]) player.y -= 3;
    if (keys["ArrowDown"] || keys["s"]) player.y += 3;
    if (keys["ArrowLeft"] || keys["a"]) player.x -= 3;
    if (keys["ArrowRight"] || keys["d"]) player.x += 3;

    if (player.x < enemyCube.x + enemyCube.size &&
        player.x + player.size > enemyCube.x &&
        player.y < enemyCube.y + enemyCube.size &&
        player.y + player.size > enemyCube.y) {
          startEncounter();
    }
  }
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if (!inEncounter) {
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.size, player.size);
    ctx.fillStyle = enemyCube.color;
    ctx.fillRect(enemyCube.x, enemyCube.y, enemyCube.size, enemyCube.size);
  }
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}
gameLoop();
